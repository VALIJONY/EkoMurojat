{% extends 'base.html' %}

{% block title %}Moderator Dashboard - EkoMurojat{% endblock %}

{% block extra_head %}
<!-- Remix Icon -->
<link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-7xl">
    
    <!-- HEADER -->
    <div class="flex flex-col md:flex-row justify-between items-end mb-8 gap-4">
        <div>
            <div class="flex items-center gap-2 mb-1">
                <span class="px-3 py-1 rounded-full bg-emerald-100 text-emerald-700 text-xs font-bold uppercase tracking-wider flex items-center gap-1">
                    <i class="ri-building-4-line"></i> {{ organization.name }}
                </span>
            </div>
            <h1 class="text-3xl font-bold text-slate-800 tracking-tight flex items-center gap-3">
                Moderator Ish Stoli
            </h1>
            <p class="text-slate-500 mt-1">Murojaatlar holati va ijro intizomi</p>
        </div>
        
        <a href="{% url 'complaints_moderator' %}" class="flex items-center gap-2 px-5 py-2.5 bg-emerald-600 text-white font-bold rounded-xl shadow-lg shadow-emerald-200 hover:bg-emerald-700 hover:shadow-xl hover:-translate-y-0.5 transition-all">
            <i class="ri-list-check-2"></i> Barcha murojaatlar
        </a>
    </div>

    <!-- STATS GRID -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
        
        <!-- Jami -->
        <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-all group relative overflow-hidden">
            <div class="absolute right-0 top-0 p-4 opacity-5">
                <i class="ri-folder-shield-2-fill text-6xl text-slate-800"></i>
            </div>
            <div class="relative z-10">
                <p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Jami murojaatlar</p>
                <div class="flex items-center gap-3">
                    <h3 class="text-3xl font-bold text-slate-800">{{ total_count }}</h3>
                    <span class="text-xs font-medium bg-slate-100 text-slate-600 px-2 py-1 rounded-lg">ta</span>
                </div>
            </div>
        </div>

        <!-- Yangi (Action needed) -->
        <div class="bg-white p-6 rounded-2xl border border-blue-100 shadow-sm hover:shadow-md transition-all group relative overflow-hidden">
            <div class="absolute right-0 top-0 p-4 opacity-5">
                <i class="ri-flashlight-fill text-6xl text-blue-600"></i>
            </div>
            <div class="relative z-10">
                <div class="flex justify-between items-start mb-2">
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">Yangi (Ko'rilmagan)</p>
                    <span class="w-2 h-2 rounded-full bg-blue-500 animate-pulse"></span>
                </div>
                <div class="flex items-center gap-3">
                    <h3 class="text-3xl font-bold text-blue-600">{{ new_count }}</h3>
                    <span class="text-xs font-medium bg-blue-50 text-blue-600 px-2 py-1 rounded-lg">ta</span>
                </div>
            </div>
        </div>

        <!-- Jarayonda -->
        <div class="bg-white p-6 rounded-2xl border border-orange-100 shadow-sm hover:shadow-md transition-all group relative overflow-hidden">
            <div class="absolute right-0 top-0 p-4 opacity-5">
                <i class="ri-loader-2-fill text-6xl text-orange-500"></i>
            </div>
            <div class="relative z-10">
                <p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Ijro jarayonida</p>
                <div class="flex items-center gap-3">
                    <h3 class="text-3xl font-bold text-orange-500">{{ in_progress_count }}</h3>
                    <span class="text-xs font-medium bg-orange-50 text-orange-600 px-2 py-1 rounded-lg">ta</span>
                </div>
            </div>
        </div>

        <!-- Hal etilgan -->
        <div class="bg-white p-6 rounded-2xl border border-emerald-100 shadow-sm hover:shadow-md transition-all group relative overflow-hidden">
            <div class="absolute right-0 top-0 p-4 opacity-5">
                <i class="ri-checkbox-circle-fill text-6xl text-emerald-600"></i>
            </div>
            <div class="relative z-10">
                <p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Hal etilgan</p>
                <div class="flex items-center gap-3">
                    <h3 class="text-3xl font-bold text-emerald-600">{{ closed_count }}</h3>
                    <span class="text-xs font-medium bg-emerald-50 text-emerald-600 px-2 py-1 rounded-lg">ta</span>
                </div>
            </div>
        </div>
    </div>

    <!-- RECENT COMPLAINTS SECTION -->
    <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
        
        <!-- Header -->
        <div class="px-6 py-5 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
            <h2 class="text-lg font-bold text-slate-800 flex items-center gap-2">
                <i class="ri-time-line text-emerald-600"></i>
                Oxirgi kelib tushganlar
            </h2>
            <a href="{% url 'complaints_moderator' %}" class="text-sm font-semibold text-emerald-600 hover:text-emerald-700 hover:underline flex items-center gap-1">
                Barchasini ko'rish <i class="ri-arrow-right-line"></i>
            </a>
        </div>

        {% if recent_complaints %}
            <div class="divide-y divide-slate-100">
                {% for complaint in recent_complaints %}
                <div class="p-6 hover:bg-slate-50 transition-colors group">
                    <div class="flex flex-col md:flex-row gap-4 items-start">
                        
                        <!-- Icon Box -->
                        <div class="flex-shrink-0">
                            <div class="w-12 h-12 rounded-xl flex items-center justify-center text-xl
                                {% if complaint.priority == 'high' %} bg-red-100 text-red-500
                                {% elif complaint.priority == 'medium' %} bg-yellow-100 text-yellow-600
                                {% else %} bg-slate-100 text-slate-500 {% endif %}">
                                {% if complaint.priority == 'high' %} <i class="ri-alarm-warning-fill"></i>
                                {% elif complaint.priority == 'medium' %} <i class="ri-alert-fill"></i>
                                {% else %} <i class="ri-file-text-line"></i> {% endif %}
                            </div>
                        </div>

                        <!-- Content -->
                        <div class="flex-1 min-w-0">
                            <div class="flex flex-wrap items-center gap-3 mb-1">
                                <h3 class="text-lg font-bold text-slate-800 truncate">
                                    <a href="{% url 'complaint_detail_moderator' complaint.pk %}" class="hover:text-emerald-600 transition-colors">
                                        {{ complaint.title }}
                                    </a>
                                </h3>
                                <span class="px-2.5 py-0.5 rounded-full text-xs font-bold uppercase border
                                    {% if complaint.status == 'new' %} bg-blue-50 text-blue-600 border-blue-100
                                    {% elif complaint.status == 'in_progress' %} bg-orange-50 text-orange-600 border-orange-100
                                    {% elif complaint.status == 'closed' %} bg-emerald-50 text-emerald-600 border-emerald-100
                                    {% elif complaint.status == 'rejected' %} bg-red-50 text-red-600 border-red-100 {% endif %}">
                                    {{ complaint.get_status_display }}
                                </span>
                            </div>
                            
                            <p class="text-slate-500 text-sm mb-3 line-clamp-1">
                                {{ complaint.description }}
                            </p>

                            <div class="flex flex-wrap items-center gap-4 text-xs font-medium text-slate-400">
                                <span class="flex items-center gap-1">
                                    <i class="ri-user-smile-line"></i> {{ complaint.user.username }}
                                </span>
                                <span class="flex items-center gap-1">
                                    <i class="ri-map-pin-line"></i> {{ complaint.region.name }}, {{ complaint.district.name }}
                                </span>
                                <span class="flex items-center gap-1">
                                    <i class="ri-calendar-line"></i> {{ complaint.created_at|date:"d.m.Y" }}
                                </span>
                            </div>
                        </div>

                        <!-- Action Button -->
                        <div class="flex-shrink-0 self-center">
                            <a href="{% url 'complaint_detail_moderator' complaint.pk %}" class="w-10 h-10 flex items-center justify-center rounded-xl bg-white border border-slate-200 text-slate-400 hover:text-emerald-600 hover:border-emerald-200 hover:bg-emerald-50 transition-all shadow-sm">
                                <i class="ri-arrow-right-s-line text-xl"></i>
                            </a>
                        </div>

                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <!-- Empty State -->
            <div class="flex flex-col items-center justify-center py-16 text-center">
                <div class="w-20 h-20 bg-emerald-50 rounded-full flex items-center justify-center mb-4 text-emerald-400 text-4xl">
                    <i class="ri-check-double-line"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800 mb-1">Hammasi joyida!</h3>
                <p class="text-slate-500">Sizning tashkilotingizga biriktirilgan yangi murojaatlar yo'q.</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}